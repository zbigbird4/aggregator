# Aggregator é—®é¢˜è¯Šæ–­å†³ç­–æ ‘

> **æ ¹æ®ç—‡çŠ¶å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜**

---

## ğŸ¯ ä½¿ç”¨è¯´æ˜

æœ¬æ–‡æ¡£æä¾›äº†æµç¨‹å›¾å¼çš„é—®é¢˜è¯Šæ–­æ–¹æ³•ã€‚æŒ‰ç…§ç—‡çŠ¶æ‰¾åˆ°å¯¹åº”çš„å†³ç­–æ ‘ï¼Œè·Ÿéšç®­å¤´é€æ­¥è¯Šæ–­é—®é¢˜ã€‚

---

## ğŸ“Š é—®é¢˜åˆ†ç±»ç´¢å¼•

1. [å®¹å™¨æ— æ³•å¯åŠ¨](#1-å®¹å™¨æ— æ³•å¯åŠ¨)
2. [å®¹å™¨é¢‘ç¹é‡å¯](#2-å®¹å™¨é¢‘ç¹é‡å¯)
3. [ä»£ç†æµ‹è¯•å¤±è´¥](#3-ä»£ç†æµ‹è¯•å¤±è´¥)
4. [è¾“å‡ºæ–‡ä»¶é—®é¢˜](#4-è¾“å‡ºæ–‡ä»¶é—®é¢˜)
5. [æ€§èƒ½é—®é¢˜](#5-æ€§èƒ½é—®é¢˜)
6. [ç½‘ç»œé—®é¢˜](#6-ç½‘ç»œé—®é¢˜)
7. [å­˜å‚¨é—®é¢˜](#7-å­˜å‚¨é—®é¢˜)

---

## 1. å®¹å™¨æ— æ³•å¯åŠ¨

```
å®¹å™¨æ— æ³•å¯åŠ¨
    â”‚
    â”œâ”€ docker-compose up æŠ¥é”™ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. è¿è¡Œ docker-compose config æ£€æŸ¥è¯­æ³•
    â”‚   â”‚       2. æ£€æŸ¥ YAML ç¼©è¿›
    â”‚   â”‚       3. éªŒè¯ç¯å¢ƒå˜é‡æ ¼å¼
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ Docker æœåŠ¡è¿è¡Œä¸­ï¼Ÿ
    â”‚   â”œâ”€ NO â†’ Docker æœåŠ¡æœªå¯åŠ¨
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       sudo systemctl start docker
    â”‚   â”‚       sudo systemctl enable docker
    â”‚   â”‚
    â”‚   â””â”€ YES â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ é•œåƒæ‹‰å–æˆåŠŸï¼Ÿ
    â”‚   â”œâ”€ NO â†’ é•œåƒæ‹‰å–å¤±è´¥
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. æ£€æŸ¥ç½‘ç»œè¿æ¥
    â”‚   â”‚       2. é…ç½®é•œåƒåŠ é€Ÿå™¨
    â”‚   â”‚       3. å°è¯•æ‰‹åŠ¨æ‹‰å–ï¼š
    â”‚   â”‚          docker pull wzdnzd/aggregator:latest
    â”‚   â”‚
    â”‚   â””â”€ YES â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ ç«¯å£å†²çªï¼Ÿ
    â”‚   â”œâ”€ YES â†’ ç«¯å£è¢«å ç”¨
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. netstat -tlnp | grep :8080
    â”‚   â”‚       2. ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£
    â”‚   â”‚       3. æˆ–åœæ­¢å ç”¨ç«¯å£çš„ç¨‹åº
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â””â”€ æƒé™é—®é¢˜ï¼Ÿ
        â”œâ”€ YES â†’ æ–‡ä»¶æˆ–ç›®å½•æƒé™ä¸è¶³
        â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
        â”‚       1. sudo chown -R $USER:$USER ./data ./logs
        â”‚       2. chmod -R 755 ./data ./logs
        â”‚       3. é‡æ–°å¯åŠ¨ï¼šdocker-compose up -d
        â”‚
        â””â”€ NO â†’ æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
            â””â”€ docker logs aggregator
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
sudo systemctl status docker          # 1. æ£€æŸ¥ Docker æœåŠ¡
docker-compose config                  # 2. éªŒè¯é…ç½®æ–‡ä»¶
docker pull wzdnzd/aggregator:latest   # 3. æµ‹è¯•é•œåƒæ‹‰å–
netstat -tlnp | grep :8080            # 4. æ£€æŸ¥ç«¯å£å ç”¨
docker logs aggregator                # 5. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```

---

## 2. å®¹å™¨é¢‘ç¹é‡å¯

```
å®¹å™¨é¢‘ç¹é‡å¯
    â”‚
    â”œâ”€ æŸ¥çœ‹é€€å‡ºç 
    â”‚   â”œâ”€ é€€å‡ºç  137 (OOMKilled) â†’ å†…å­˜ä¸è¶³
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. å¢åŠ å†…å­˜é™åˆ¶ï¼š
    â”‚   â”‚          deploy:
    â”‚   â”‚            resources:
    â”‚   â”‚              limits:
    â”‚   â”‚                memory: 2G
    â”‚   â”‚       2. æˆ–ä¼˜åŒ–å¹¶å‘æ•°ï¼š-n 16
    â”‚   â”‚
    â”‚   â”œâ”€ é€€å‡ºç  1 â†’ ç¨‹åºå¼‚å¸¸é€€å‡º
    â”‚   â”‚   â””â”€ ç»§ç»­ â†“ æŸ¥çœ‹æ—¥å¿—
    â”‚   â”‚
    â”‚   â””â”€ é€€å‡ºç  0 â†’ æ­£å¸¸é€€å‡ºä½†æ„å¤–é‡å¯
    â”‚       â””â”€ æ£€æŸ¥ restart ç­–ç•¥
    â”‚
    â”œâ”€ æŸ¥çœ‹å®¹å™¨æ—¥å¿—ä¸­çš„é”™è¯¯
    â”‚   â”œâ”€ "environment cannot be empty" â†’ ç¯å¢ƒå˜é‡ç¼ºå¤±
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. æ£€æŸ¥ .env æ–‡ä»¶
    â”‚   â”‚       2. ç¡®ä¿é…ç½®äº†ï¼š
    â”‚   â”‚          GIST_PAT=ghp_...
    â”‚   â”‚          GIST_LINK=username/gist_id
    â”‚   â”‚       3. é‡å¯ï¼šdocker-compose restart aggregator
    â”‚   â”‚
    â”‚   â”œâ”€ "Permission denied" â†’ æƒé™é—®é¢˜
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. chmod -R 755 ./data ./logs
    â”‚   â”‚       2. chown -R $USER:$USER ./data ./logs
    â”‚   â”‚       3. docker-compose down && docker-compose up -d
    â”‚   â”‚
    â”‚   â”œâ”€ "Network timeout" â†’ ç½‘ç»œè¿æ¥é—®é¢˜
    â”‚   â”‚   â””â”€ è·³è½¬åˆ° [ç½‘ç»œé—®é¢˜](#6-ç½‘ç»œé—®é¢˜)
    â”‚   â”‚
    â”‚   â””â”€ å…¶ä»–é”™è¯¯ â†’ æŸ¥çœ‹å®Œæ•´æ—¥å¿—
    â”‚       â””â”€ docker logs --tail 200 aggregator > debug.log
    â”‚
    â””â”€ æ£€æŸ¥å¥åº·çŠ¶æ€
        â””â”€ docker inspect aggregator | jq '.[0].State.Health'
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
docker inspect aggregator | jq '.[0].State.ExitCode'   # 1. æŸ¥çœ‹é€€å‡ºç 
docker logs --tail 100 aggregator                      # 2. æŸ¥çœ‹æ—¥å¿—
docker stats aggregator --no-stream                    # 3. æŸ¥çœ‹èµ„æºä½¿ç”¨
docker inspect aggregator | jq '.[0].State.Health'     # 4. æŸ¥çœ‹å¥åº·çŠ¶æ€
docker-compose ps                                      # 5. æŸ¥çœ‹é‡å¯æ¬¡æ•°
```

---

## 3. ä»£ç†æµ‹è¯•å¤±è´¥

```
ä»£ç†æµ‹è¯•å¤±è´¥
    â”‚
    â”œâ”€ æ‰€æœ‰ä»£ç†éƒ½å¤±è´¥ (0% æˆåŠŸç‡)ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ æµ‹è¯•ç¯å¢ƒé—®é¢˜
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ èƒ½è®¿é—®å¤–ç½‘ï¼Ÿ
    â”‚   â”‚   â”‚   â”œâ”€ NO â†’ å®¹å™¨ç½‘ç»œé—®é¢˜
    â”‚   â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚   â”‚       1. docker exec aggregator ping -c 3 8.8.8.8
    â”‚   â”‚   â”‚   â”‚       2. docker exec aggregator curl -I https://www.google.com
    â”‚   â”‚   â”‚   â”‚       3. é…ç½® DNSï¼š
    â”‚   â”‚   â”‚   â”‚          dns:
    â”‚   â”‚   â”‚   â”‚            - 8.8.8.8
    â”‚   â”‚   â”‚   â”‚            - 1.1.1.1
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€ YES â†’ ç»§ç»­ â†“
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ Clash äºŒè¿›åˆ¶å¯æ‰§è¡Œï¼Ÿ
    â”‚   â”‚   â”‚   â”œâ”€ NO â†’ æƒé™æˆ–æ¶æ„é—®é¢˜
    â”‚   â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚   â”‚       1. docker exec aggregator ls -la /aggregator/clash/
    â”‚   â”‚   â”‚   â”‚       2. docker exec aggregator chmod +x /aggregator/clash/clash-linux-amd
    â”‚   â”‚   â”‚   â”‚       3. docker exec aggregator /aggregator/clash/clash-linux-amd -v
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€ YES â†’ ç»§ç»­ â†“
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ ä»£ç†æ ¼å¼æ­£ç¡®ï¼Ÿ
    â”‚   â”‚       â”œâ”€ NO â†’ ä»£ç†æ ¼å¼é”™è¯¯
    â”‚   â”‚       â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       â”‚       1. docker exec aggregator cat /aggregator/data/proxies.txt
    â”‚   â”‚       â”‚       2. æ£€æŸ¥ä»£ç†æ ¼å¼ï¼švmess://... trojan://...
    â”‚   â”‚       â”‚       3. é‡æ–°æ”¶é›†ä»£ç†
    â”‚   â”‚       â”‚
    â”‚   â”‚       â””â”€ YES â†’ ä»£ç†æºè´¨é‡å·®
    â”‚   â”‚           â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚               1. ç­‰å¾…ä¸‹æ¬¡æ›´æ–°
    â”‚   â”‚               2. æˆ–é…ç½®å…¶ä»–ä»£ç†æº
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ éƒ¨åˆ†ä»£ç†å¤±è´¥ (< 50% æˆåŠŸç‡)
    â”‚       â””â”€ è¿™æ˜¯æ­£å¸¸ç°è±¡
    â”‚           â””â”€ å…è´¹ä»£ç†æœ¬èº«è´¨é‡å‚å·®ä¸é½
    â”‚               å»ºè®®ï¼š
    â”‚               1. å®šæœŸè¿è¡Œæ›´æ–°ä»£ç†
    â”‚               2. å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´ï¼š-t 10000
    â”‚               3. é™ä½å¹¶å‘å‡å°‘è¯¯åˆ¤ï¼š-n 32
    â”‚
    â””â”€ æµ‹è¯•é€Ÿåº¦å¾ˆæ…¢ï¼Ÿ
        â””â”€ è·³è½¬åˆ° [æ€§èƒ½é—®é¢˜](#5-æ€§èƒ½é—®é¢˜)
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
docker exec aggregator ping -c 3 8.8.8.8                               # 1. æµ‹è¯•ç½‘ç»œ
docker exec aggregator /aggregator/clash/clash-linux-amd -v            # 2. æµ‹è¯• Clash
docker exec aggregator cat /aggregator/data/proxies.txt | head -10     # 3. æ£€æŸ¥ä»£ç†
docker exec aggregator python -u subscribe/collect.py --check          # 4. é‡æ–°æµ‹è¯•
```

---

## 4. è¾“å‡ºæ–‡ä»¶é—®é¢˜

```
è¾“å‡ºæ–‡ä»¶é—®é¢˜
    â”‚
    â”œâ”€ æ–‡ä»¶å®Œå…¨æ²¡æœ‰ç”Ÿæˆï¼Ÿ
    â”‚   â”œâ”€ YES â†’ æ£€æŸ¥æ—¥å¿—
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ "No valid proxies" â†’ æ²¡æœ‰æœ‰æ•ˆä»£ç†
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. ç¡®ä¿ä»£ç†æµ‹è¯•æˆåŠŸ
    â”‚   â”‚   â”‚       2. æ£€æŸ¥ä»£ç†æ¥æºé…ç½®
    â”‚   â”‚   â”‚       3. æŸ¥çœ‹ä»£ç†æ•°é‡ï¼š
    â”‚   â”‚   â”‚          docker exec aggregator wc -l /aggregator/data/proxies.txt
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ "Failed to upload to Gist" â†’ Gist ä¸Šä¼ å¤±è´¥
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â”œâ”€ Token æ— æ•ˆï¼Ÿ
    â”‚   â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚   â”‚       1. é‡æ–°ç”Ÿæˆ GitHub Token
    â”‚   â”‚   â”‚   â”‚       2. ç¡®ä¿æœ‰ gist æƒé™
    â”‚   â”‚   â”‚   â”‚       3. æ›´æ–° .env ä¸­çš„ GIST_PAT
    â”‚   â”‚   â”‚   â”‚       4. é‡å¯ï¼šdocker-compose restart aggregator
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€ Gist ID é”™è¯¯ï¼Ÿ
    â”‚   â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚           1. éªŒè¯ GIST_LINK æ ¼å¼ï¼šusername/gist_id
    â”‚   â”‚   â”‚           2. è®¿é—® Gist URL ç¡®è®¤å­˜åœ¨
    â”‚   â”‚   â”‚           3. æ›´æ–° .env ä¸­çš„ GIST_LINK
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ "Permission denied" â†’ æ–‡ä»¶æƒé™é—®é¢˜
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           1. chmod -R 755 ./data
    â”‚   â”‚           2. chown -R $USER:$USER ./data
    â”‚   â”‚           3. docker-compose restart aggregator
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ æ–‡ä»¶ç”Ÿæˆä½†æŸåï¼Ÿ
    â”‚   â”œâ”€ YES â†’ éªŒè¯æ–‡ä»¶æ ¼å¼
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ YAML æ ¼å¼é”™è¯¯ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       docker exec aggregator python -c "
    â”‚   â”‚   â”‚       import yaml
    â”‚   â”‚   â”‚       with open('/aggregator/data/clash.yaml') as f:
    â”‚   â”‚   â”‚           yaml.safe_load(f)
    â”‚   â”‚   â”‚       "
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ æ–‡ä»¶æˆªæ–­ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼šdf -h
    â”‚   â”‚   â”‚       2. æ¸…ç†ç©ºé—´ï¼šdocker system prune -a
    â”‚   â”‚   â”‚       3. é‡æ–°ç”Ÿæˆï¼šdocker-compose restart aggregator
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ ç¼–ç é—®é¢˜ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           docker exec aggregator file /aggregator/data/clash.yaml
    â”‚   â”‚           # åº”è¯¥æ˜¯ UTF-8
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â””â”€ æ–‡ä»¶ç”Ÿæˆä½†æ— æ³•ä½¿ç”¨ï¼Ÿ
        â””â”€ Clash å®¢æˆ·ç«¯æŠ¥é”™
            â””â”€ è§£å†³æ–¹æ¡ˆï¼š
                1. æ£€æŸ¥ Clash æ—¥å¿—æŸ¥çœ‹å…·ä½“é”™è¯¯
                2. éªŒè¯ä»£ç†èŠ‚ç‚¹æ ¼å¼
                3. ç¡®è®¤å®¢æˆ·ç«¯ç‰ˆæœ¬å…¼å®¹æ€§
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
docker-compose logs aggregator | grep -i "gist\|upload\|output"       # 1. æŸ¥çœ‹ä¸Šä¼ æ—¥å¿—
docker exec aggregator ls -la /aggregator/data/                        # 2. æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
docker exec aggregator cat /aggregator/data/clash.yaml | head -30      # 3. æŸ¥çœ‹æ–‡ä»¶å†…å®¹
df -h                                                                  # 4. æ£€æŸ¥ç£ç›˜ç©ºé—´
```

---

## 5. æ€§èƒ½é—®é¢˜

```
æ€§èƒ½é—®é¢˜
    â”‚
    â”œâ”€ CPU ä½¿ç”¨ç‡ > 90%ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ CPU ç“¶é¢ˆ
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ å¹¶å‘æ•°è¿‡é«˜ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. é™ä½å¹¶å‘æ•°ï¼š-n 16
    â”‚   â”‚   â”‚       2. æˆ–å¢åŠ  CPU é™åˆ¶ï¼š
    â”‚   â”‚   â”‚          deploy:
    â”‚   â”‚   â”‚            resources:
    â”‚   â”‚   â”‚              limits:
    â”‚   â”‚   â”‚                cpus: '4'
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ CPU é™åˆ¶å¤ªä½ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           å¢åŠ  CPU é™åˆ¶ï¼ˆè§ä¸Šï¼‰
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ å†…å­˜ä½¿ç”¨ç‡ > 80%ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ å†…å­˜ç“¶é¢ˆ
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ å†…å­˜é™åˆ¶å¤ªä½ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       deploy:
    â”‚   â”‚   â”‚         resources:
    â”‚   â”‚   â”‚           limits:
    â”‚   â”‚   â”‚             memory: 2G
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ å¹¶å‘æ•°è¿‡é«˜ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           1. é™ä½å¹¶å‘æ•°ï¼š-n 32
    â”‚   â”‚           2. å‡å°‘æ‰¹å¤„ç†å¤§å°
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ æµ‹è¯•é€Ÿåº¦æ…¢ï¼Ÿ
    â”‚   â””â”€ å¯èƒ½åŸå› åˆ†æ
    â”‚       â”‚
    â”‚       â”œâ”€ ç½‘ç»œå»¶è¿Ÿé«˜ï¼Ÿ
    â”‚       â”‚   â””â”€ æµ‹è¯•ï¼š
    â”‚       â”‚       docker exec aggregator ping -c 10 8.8.8.8
    â”‚       â”‚       â””â”€ å¦‚æœå»¶è¿Ÿ > 100msï¼Œè€ƒè™‘ä¼˜åŒ–ç½‘ç»œ
    â”‚       â”‚
    â”‚       â”œâ”€ å¹¶å‘æ•°å¤ªä½ï¼Ÿ
    â”‚       â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚       â”‚       1. å¢åŠ å¹¶å‘æ•°ï¼š-n 128
    â”‚       â”‚       2. ç¡®ä¿ CPU å’Œå†…å­˜å……è¶³
    â”‚       â”‚
    â”‚       â”œâ”€ ç£ç›˜ I/O æ…¢ï¼Ÿ
    â”‚       â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚       â”‚       1. ä½¿ç”¨ SSD å­˜å‚¨
    â”‚       â”‚       2. æµ‹è¯• I/Oï¼š
    â”‚       â”‚          docker exec aggregator dd if=/dev/zero of=/tmp/test bs=1M count=100
    â”‚       â”‚
    â”‚       â””â”€ è¶…æ—¶æ—¶é—´å¤ªé•¿ï¼Ÿ
    â”‚           â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚               å‡å°‘è¶…æ—¶ï¼š-t 5000  # 5ç§’
    â”‚
    â””â”€ æŸ¥çœ‹èµ„æºä½¿ç”¨è¯¦æƒ…
        â””â”€ docker stats aggregator
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
docker stats aggregator --no-stream                    # 1. æŸ¥çœ‹èµ„æºä½¿ç”¨
docker exec aggregator top -b -n 1                     # 2. æŸ¥çœ‹è¿›ç¨‹
docker exec aggregator ping -c 10 8.8.8.8              # 3. æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ
free -h                                                # 4. æŸ¥çœ‹ç³»ç»Ÿå†…å­˜
```

---

## 6. ç½‘ç»œé—®é¢˜

```
ç½‘ç»œé—®é¢˜
    â”‚
    â”œâ”€ å®¹å™¨èƒ½å¦è®¿é—®å¤–ç½‘ï¼Ÿ
    â”‚   â”œâ”€ NO â†’ å®¹å™¨ç½‘ç»œé…ç½®é—®é¢˜
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ DNS è§£æå¤±è´¥ï¼Ÿ
    â”‚   â”‚   â”‚   â”œâ”€ YES â†’ DNS é…ç½®é—®é¢˜
    â”‚   â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚   â”‚       1. åœ¨ docker-compose.yml ä¸­é…ç½® DNSï¼š
    â”‚   â”‚   â”‚   â”‚          dns:
    â”‚   â”‚   â”‚   â”‚            - 8.8.8.8
    â”‚   â”‚   â”‚   â”‚            - 1.1.1.1
    â”‚   â”‚   â”‚   â”‚       2. æˆ–é…ç½® Docker daemonï¼š
    â”‚   â”‚   â”‚   â”‚          /etc/docker/daemon.json:
    â”‚   â”‚   â”‚   â”‚          {"dns": ["8.8.8.8", "1.1.1.1"]}
    â”‚   â”‚   â”‚   â”‚       3. é‡å¯ Dockerï¼š
    â”‚   â”‚   â”‚   â”‚          sudo systemctl restart docker
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ ç½‘ç»œæ¨¡å¼é”™è¯¯ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. æ£€æŸ¥ç½‘ç»œæ¨¡å¼ï¼š
    â”‚   â”‚   â”‚          docker inspect aggregator | jq '.[0].HostConfig.NetworkMode'
    â”‚   â”‚   â”‚       2. å°è¯• host æ¨¡å¼ï¼š
    â”‚   â”‚   â”‚          network_mode: host
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ é˜²ç«å¢™é˜»æ­¢ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           1. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼š
    â”‚   â”‚              sudo iptables -L
    â”‚   â”‚           2. å…è®¸ Docker ç½‘ç»œï¼š
    â”‚   â”‚              sudo ufw allow from 172.16.0.0/12
    â”‚   â”‚
    â”‚   â””â”€ YES â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ GitHub API è®¿é—®å¤±è´¥ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ GitHub è¿æ¥é—®é¢˜
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ Token æ— æ•ˆï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. æµ‹è¯• Tokenï¼š
    â”‚   â”‚   â”‚          curl -H "Authorization: token $GIST_PAT" \
    â”‚   â”‚   â”‚            https://api.github.com/user
    â”‚   â”‚   â”‚       2. é‡æ–°ç”Ÿæˆ Token
    â”‚   â”‚   â”‚       3. æ›´æ–° .env æ–‡ä»¶
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ Rate Limitï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. æ£€æŸ¥é™æµçŠ¶æ€ï¼š
    â”‚   â”‚   â”‚          curl -H "Authorization: token $GIST_PAT" \
    â”‚   â”‚   â”‚            https://api.github.com/rate_limit
    â”‚   â”‚   â”‚       2. ç­‰å¾…é™æµé‡ç½®
    â”‚   â”‚   â”‚       3. æˆ–ä½¿ç”¨å¤šä¸ª Token è½®è¯¢
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ ç½‘ç»œè¢«å°ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           1. ä½¿ç”¨ä»£ç†è®¿é—® GitHub
    â”‚   â”‚           2. é…ç½®ç¯å¢ƒå˜é‡ï¼š
    â”‚   â”‚              HTTP_PROXY=http://proxy:8080
    â”‚   â”‚              HTTPS_PROXY=http://proxy:8080
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â””â”€ ä»£ç†æµ‹è¯•è¶…æ—¶ï¼Ÿ
        â””â”€ è§£å†³æ–¹æ¡ˆï¼š
            1. å¢åŠ è¶…æ—¶æ—¶é—´ï¼š-t 15000
            2. å‡å°‘å¹¶å‘æ•°ï¼š-n 16
            3. æ£€æŸ¥æœ¬åœ°ç½‘ç»œç¯å¢ƒ
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
docker exec aggregator ping -c 3 8.8.8.8                               # 1. æµ‹è¯•ç½‘ç»œ
docker exec aggregator nslookup google.com                             # 2. æµ‹è¯• DNS
docker exec aggregator curl -I https://api.github.com                  # 3. æµ‹è¯• GitHub
docker inspect aggregator | jq '.[0].HostConfig.NetworkMode'          # 4. æŸ¥çœ‹ç½‘ç»œæ¨¡å¼
```

---

## 7. å­˜å‚¨é—®é¢˜

```
å­˜å‚¨é—®é¢˜
    â”‚
    â”œâ”€ ç£ç›˜ç©ºé—´ä¸è¶³ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ æ¸…ç†ç£ç›˜ç©ºé—´
    â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚       1. æ¸…ç† Docker ç¼“å­˜ï¼š
    â”‚   â”‚          docker system prune -a
    â”‚   â”‚       2. æ¸…ç†æ—§æ—¥å¿—ï¼š
    â”‚   â”‚          find ./logs -name "*.log" -mtime +30 -delete
    â”‚   â”‚       3. æ¸…ç†æ—§å¤‡ä»½ï¼š
    â”‚   â”‚          find ./backups -name "*.tar.gz" -mtime +30 -delete
    â”‚   â”‚       4. æ£€æŸ¥å¤§æ–‡ä»¶ï¼š
    â”‚   â”‚          du -sh ./data/* | sort -rh | head -10
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ æ•°æ®ä¸¢å¤±ï¼Ÿ
    â”‚   â”œâ”€ YES â†’ æ•°æ®å·é…ç½®é—®é¢˜
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ æœªé…ç½®æ•°æ®å·ï¼Ÿ
    â”‚   â”‚   â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚   â”‚       1. åœ¨ docker-compose.yml ä¸­é…ç½®ï¼š
    â”‚   â”‚   â”‚          volumes:
    â”‚   â”‚   â”‚            - ./data:/aggregator/data
    â”‚   â”‚   â”‚            - ./logs:/aggregator/logs
    â”‚   â”‚   â”‚       2. é‡æ–°åˆ›å»ºå®¹å™¨ï¼š
    â”‚   â”‚   â”‚          docker-compose down
    â”‚   â”‚   â”‚          docker-compose up -d
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ æ•°æ®å·è¢«åˆ é™¤ï¼Ÿ
    â”‚   â”‚       â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚   â”‚           1. ä»å¤‡ä»½æ¢å¤
    â”‚   â”‚           2. é…ç½®è‡ªåŠ¨å¤‡ä»½é˜²æ­¢å†æ¬¡å‘ç”Ÿ
    â”‚   â”‚
    â”‚   â””â”€ NO â†’ ç»§ç»­ â†“
    â”‚
    â”œâ”€ å†™å…¥æƒé™è¢«æ‹’ç»ï¼Ÿ
    â”‚   â””â”€ è§£å†³æ–¹æ¡ˆï¼š
    â”‚       1. æ£€æŸ¥ç›®å½•æƒé™ï¼š
    â”‚          ls -la ./data ./logs
    â”‚       2. ä¿®æ”¹æƒé™ï¼š
    â”‚          chmod -R 755 ./data ./logs
    â”‚       3. ä¿®æ”¹æ‰€æœ‰è€…ï¼š
    â”‚          chown -R $USER:$USER ./data ./logs
    â”‚       4. é‡å¯å®¹å™¨ï¼š
    â”‚          docker-compose restart aggregator
    â”‚
    â””â”€ I/O æ€§èƒ½å·®ï¼Ÿ
        â””â”€ è§£å†³æ–¹æ¡ˆï¼š
            1. æµ‹è¯• I/O æ€§èƒ½ï¼š
               docker exec aggregator dd if=/dev/zero of=/tmp/test bs=1M count=1000
            2. ä½¿ç”¨ SSD å­˜å‚¨
            3. è°ƒæ•´å·æŒ‚è½½é€‰é¡¹ï¼š
               volumes:
                 - ./data:/aggregator/data:cached
```

**å¿«é€Ÿå‘½ä»¤é›†**ï¼š
```bash
# è¯Šæ–­æ­¥éª¤
df -h                                                  # 1. æ£€æŸ¥ç£ç›˜ç©ºé—´
docker system df -v                                    # 2. æ£€æŸ¥ Docker ç£ç›˜ä½¿ç”¨
ls -la ./data ./logs                                   # 3. æ£€æŸ¥æƒé™
docker inspect aggregator | jq '.[0].Mounts'           # 4. æ£€æŸ¥æ•°æ®å·é…ç½®
```

---

## ğŸ” é€šç”¨è¯Šæ–­æµç¨‹

å½“é‡åˆ°æ— æ³•å½’ç±»çš„é—®é¢˜æ—¶ï¼ŒæŒ‰ç…§ä»¥ä¸‹æµç¨‹è¿›è¡Œè¯Šæ–­ï¼š

```
é—®é¢˜å‡ºç°
    â†“
1. æ”¶é›†ä¿¡æ¯
   - æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼šdocker-compose ps
   - æŸ¥çœ‹æ—¥å¿—ï¼šdocker-compose logs --tail=100 aggregator
   - æŸ¥çœ‹èµ„æºä½¿ç”¨ï¼šdocker stats aggregator --no-stream
   - æŸ¥çœ‹ç³»ç»Ÿèµ„æºï¼šfree -h && df -h
    â†“
2. å®šä½é—®é¢˜
   - å®¹å™¨å¯åŠ¨é—®é¢˜ï¼Ÿ â†’ è·³è½¬åˆ° [å®¹å™¨æ— æ³•å¯åŠ¨](#1-å®¹å™¨æ— æ³•å¯åŠ¨)
   - å®¹å™¨è¿è¡Œä½†æœ‰é”™è¯¯ï¼Ÿ â†’ æ ¹æ®é”™è¯¯ç±»å‹é€‰æ‹©å¯¹åº”å†³ç­–æ ‘
   - æ€§èƒ½é—®é¢˜ï¼Ÿ â†’ è·³è½¬åˆ° [æ€§èƒ½é—®é¢˜](#5-æ€§èƒ½é—®é¢˜)
   - ç½‘ç»œé—®é¢˜ï¼Ÿ â†’ è·³è½¬åˆ° [ç½‘ç»œé—®é¢˜](#6-ç½‘ç»œé—®é¢˜)
    â†“
3. å°è¯•è§£å†³
   - æŒ‰ç…§å†³ç­–æ ‘æŒ‡å¼•é€æ­¥æ“ä½œ
   - æ¯æ¬¡æ“ä½œåéªŒè¯æ•ˆæœ
   - è®°å½•æ“ä½œæ­¥éª¤å’Œç»“æœ
    â†“
4. éªŒè¯è§£å†³
   - åŠŸèƒ½æ­£å¸¸ï¼Ÿ â†’ é—®é¢˜è§£å†³ âœ…
   - ä»æœ‰é—®é¢˜ï¼Ÿ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
    â†“
5. å¯»æ±‚å¸®åŠ©
   - æ”¶é›†å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ï¼ˆè§ä¸‹æ–¹ï¼‰
   - æäº¤ GitHub Issue
   - æˆ–åœ¨ Discussions ä¸­æé—®
```

---

## ğŸ“‹ è¯Šæ–­ä¿¡æ¯æ”¶é›†æ¸…å•

åœ¨æäº¤ Issue æˆ–å¯»æ±‚å¸®åŠ©å‰ï¼Œè¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š

```bash
#!/bin/bash
# è¯Šæ–­ä¿¡æ¯æ”¶é›†è„šæœ¬

mkdir -p debug-info
cd debug-info

# 1. ç³»ç»Ÿä¿¡æ¯
echo "=== ç³»ç»Ÿä¿¡æ¯ ===" > system-info.txt
uname -a >> system-info.txt
docker --version >> system-info.txt
docker-compose --version >> system-info.txt
free -h >> system-info.txt
df -h >> system-info.txt

# 2. å®¹å™¨çŠ¶æ€
docker-compose ps > container-status.txt
docker inspect aggregator > container-inspect.json

# 3. æ—¥å¿—
docker logs --tail 500 aggregator > container-logs.txt 2>&1

# 4. èµ„æºä½¿ç”¨
docker stats aggregator --no-stream > resource-usage.txt

# 5. é…ç½®æ–‡ä»¶ï¼ˆè„±æ•ï¼‰
cp ../docker-compose.yml docker-compose.yml
# æ‰‹åŠ¨ç¼–è¾‘ç§»é™¤æ•æ„Ÿä¿¡æ¯

# 6. ç¯å¢ƒå˜é‡ï¼ˆè„±æ•ï¼‰
docker exec aggregator env | grep -v "PAT\|TOKEN\|PASSWORD" > env-vars.txt

# æ‰“åŒ…
cd ..
tar -czf debug-info-$(date +%Y%m%d-%H%M%S).tar.gz debug-info/
echo "âœ… è¯Šæ–­ä¿¡æ¯å·²æ”¶é›†åˆ°: debug-info-$(date +%Y%m%d-%H%M%S).tar.gz"
```

---

## ğŸ“š ç›¸å…³èµ„æº

- ğŸ“– [å®Œæ•´å®‰è£…æŒ‡å¼•](./INSTALLATION.md)
- ğŸ› [è¯¦ç»†è°ƒè¯•æŒ‡å¼•](./DEBUG.md)
- ğŸ“‹ [å¿«é€Ÿå‚è€ƒå¡](./QUICK_REFERENCE.md)
- ğŸ”§ [æœ€ä½³å®è·µ](./BEST_PRACTICES.md)
- ğŸ’¬ [GitHub Issues](https://github.com/wzdnzd/aggregator/issues)
- ğŸ—£ï¸ [GitHub Discussions](https://github.com/wzdnzd/aggregator/discussions)

---

**ğŸ“ æ–‡æ¡£æ›´æ–°**: 2024-11  
**âœï¸ ä½œè€…**: wzdnzd  
**ğŸ”— é¡¹ç›®åœ°å€**: https://github.com/wzdnzd/aggregator

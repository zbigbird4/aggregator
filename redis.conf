# Redis 配置文件 - 用于 Docker Compose 中的 Redis 服务

# 绑定地址 - Docker中使用0.0.0.0允许容器间通信
bind 0.0.0.0

# 监听端口
port 6379

# TCP连接的backlog大小
tcp-backlog 511

# 客户端空闲超时（秒），0表示禁用
timeout 0

# TCP连接保活检测（秒）
tcp-keepalive 300

# 后台运行
daemonize no

# 指定日志级别（debug, verbose, notice, warning）
loglevel notice

# 数据库数量
databases 16

# 启用持久化 - AOF（Append Only File）
appendonly yes

# AOF文件名
appendfilename "appendonly.aof"

# AOF同步策略
# always - 每次写操作都同步（安全但性能差）
# everysec - 每秒同步一次（平衡）
# no - 由操作系统决定（最快但可能丢数据）
appendfsync everysec

# RDB持久化 - 快照
# 触发条件：key变化数 在 秒数内
save 900 1         # 900秒内至少1个key改变
save 300 10        # 300秒内至少10个key改变
save 60 10000      # 60秒内至少10000个key改变

# RDB文件名
dbfilename "dump.rdb"

# RDB文件保存目录
dir /data

# 最大内存限制
maxmemory 256mb

# 内存淘汰策略
# allkeys-lru - 在所有键中使用LRU淘汰
# volatile-lru - 在设置过期时间的键中使用LRU淘汰
# allkeys-lfu - 在所有键中使用LFU淘汰
# volatile-lfu - 在设置过期时间的键中使用LFU淘汰
# volatile-random - 随机删除设置过期的键
# allkeys-random - 随机删除所有键
# volatile-ttl - 删除剩余TTL最短的键
# noeviction - 不删除任何键，内存满时返回错误
maxmemory-policy allkeys-lru

# 其他安全建议：

# 慢查询日志
slowlog-log-slower-than 10000
slowlog-max-len 128

# 日志输出
loglevel warning

# 信息采集间隔
hz 10

# 停用危险命令（可选）
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command CONFIG ""
